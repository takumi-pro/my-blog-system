---
title: "Ubuntuã«SSHã§å…¬é–‹éµèªè¨¼ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹"
emoji: "ğŸˆ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: []
published: true
publishedAt: "2023/07/02"
---

## å‹•ä½œç’°å¢ƒ
- Ubuntu 20.04.6 LTS

## sshdã®æœ‰åŠ¹åŒ–
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§`sshd`ãŒã„ã‚“ã™ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã‹ã£ãŸãŸã‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
```bash
sudo apt update
sudo apt -y install openssh-server
```

èµ·å‹•ç¢ºèª
```bash
systemctl status ssh
```

## ãƒ­ãƒ¼ã‚«ãƒ«PCã§ã‚„ã‚‹ã“ã¨
### ãƒ­ãƒ¼ã‚«ãƒ«PCã‹ã‚‰å…¬é–‹éµã‚’Ubuntuã«é€ã‚‹
scpã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦éµã‚’é€ã‚‹
```bash
scp [éµãƒ•ã‚¡ã‚¤ãƒ«] [ãƒ¦ãƒ¼ã‚¶]@[Ubuntu ipã‚¢ãƒ‰ãƒ¬ã‚¹ or ãƒ›ã‚¹ãƒˆå]:[Ubuntuãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª]
```
```bash
scp ~/.ssh/id_rsa.pub takumi@192.168.11.100:~/.ssh
```

## Ubuntuã§ã‚„ã‚‹ã“ã¨
### è»¢é€ã•ã‚ŒãŸå…¬é–‹éµãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚¡ã‚¤ãƒ«åå¤‰æ›´
å…ˆã»ã©ã®scpã‚³ãƒãƒ³ãƒ‰ã§ãƒ­ãƒ¼ã‚«ãƒ«PCã®å…¬é–‹éµã¯~/.sshãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«id_rsa.pubã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«åã§æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã€‚å…¬é–‹éµã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’authorized_keyã«å¤‰æ›´ã™ã‚‹ã€‚
```bash
cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys

# å…ƒã®id_rsa.pubã¯å‰Šé™¤ã™ã‚‹
rm ~/.ssh/id_rsa.pub
```

### ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¨©é™ç·¨é›†
ç®¡ç†è€…ã®ã¿ãŒé–²è¦§ã€æ›¸ãè¾¼ã¿ãŒã§ãã‚‹ã‚ˆã†ã«authorized_keyãƒ•ã‚¡ã‚¤ãƒ«ã®æ¨©é™ã‚’ç·¨é›†ã™ã‚‹
```bash
chmod 600 ~/.ssh/authorized_keys

# æ¨©é™ç¢ºèª
ls -l ~/.ssh
-rw------- 1 takumi takumi 500 1
```

### sshdã®è¨­å®š
`/etc/ssh/sshd_config`ã§sshã®è¨­å®šã‚’ã™ã‚‹
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã®ç¦æ­¢
- ãƒ«ãƒ¼ãƒˆãƒ­ã‚°ã‚¤ãƒ³ã®ç¦æ­¢
- å…¬é–‹éµèªè¨¼ã®è¨±å¯

ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†
```bash
# ãƒ«ãƒ¼ãƒˆãƒ­ã‚°ã‚¤ãƒ³ã®ç¦æ­¢
PermitRootLogin no

# å…¬é–‹éµèªè¨¼ã®è¨±å¯
PubkeyAuthentication yes

# ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã®ç¦æ­¢
PasswordAuthentication no
```

### sshdã®å†èµ·å‹•
```bash
sudo systemctl restart ssh
```

## ssh configã‚’è¨­å®šã™ã‚‹
ipã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„ãƒ¦ãƒ¼ã‚¶ã®æŒ‡å®šã‚’ã™ã‚‹å¿…è¦ãŒãªããªã‚‹ãŸã‚ssh configã‚’è¨­å®šã—ã¦ãŠãã€‚
`~/.ssh/config`ã‚’ç·¨é›†
```bash
Host home-server
  HostName 192.168.11.100
  Identityfile ~/.ssh/id_rsa
  User takumi
```

sshã§home-serverã‚’æŒ‡å®šã™ã‚‹ã ã‘ã§æ¥ç¶šã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸ
```bash
ssh home-server
Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.15.0-76-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

Expanded Security Maintenance for Applications is not enabled.

45ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã¯ã™ãã«é©ç”¨ã•ã‚Œã¾ã™ã€‚
ã“ã‚Œã‚‰ã®è¿½åŠ ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’ç¢ºèªã™ã‚‹ã«ã¯æ¬¡ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„: apt list --upgradable

7 additional security updates can be applied with ESM Apps.
Learn more about enabling ESM Apps service at https://ubuntu.com/esm

New release '22.04.2 LTS' available.
Run 'do-release-upgrade' to upgrade to it.

Your Hardware Enablement Stack (HWE) is supported until April 2025.
Last login: Sun Jul  2 11:56:27 2023 from 192.168.11.5
takumi@takumi-ThinkPad-L460:~$ exit

```