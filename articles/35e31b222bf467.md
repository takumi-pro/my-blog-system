---
title: "dockerã§tomcatç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¦Javaã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹"
emoji: "ğŸˆ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: []
published: true
publishedAt: "2023/08/12"
---

ã‚¹ãƒƒã‚­ãƒªã‚ã‹ã‚‹ã‚µãƒ¼ãƒ–ãƒ¬ãƒƒãƒˆ&JSPã‚’å‚è€ƒã«ã—ã¦å­¦ç¿’ã‚’é€²ã‚ã¦ã„ãä¸­ã§ã€Tomcatã®èµ·å‹•ãƒ»åœæ­¢ãŒé¢å€’ã«ãªã£ãŸã®ã¨ãƒ­ãƒ¼ã‚«ãƒ«ã‚’æ±šã—ãŸããªã„ã¨ã„ã†ç†ç”±ã§dockerã§Tomcatç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ã«ã—ãŸã€‚

## ç’°å¢ƒ
- Docker: 20.10.11
- Java: 16.0.1
- Tomcat: 10.0.14

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
```bash
web-app
â”œâ”€â”€ docker
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yaml
â”œâ”€â”€ pom.xml
â”œâ”€â”€ src
â”‚   â””â”€â”€ main
â”‚       â”œâ”€â”€ java
â”‚       â”‚   â””â”€â”€ com
â”‚       â”‚       â””â”€â”€ webapp
â”‚       â”‚           â””â”€â”€ HelloServlet.java
â”‚       â””â”€â”€ webapp
â”‚           â”œâ”€â”€ WEB-INF
â”‚           â”‚   â””â”€â”€ web.xml
â”‚           â”œâ”€â”€ index.jsp
â””â”€â”€ target
    â”œâ”€â”€ classes
    â”‚   â””â”€â”€...
    â”œâ”€â”€ generated-sources
    â”‚   â””â”€â”€ annotations
    â”œâ”€â”€ maven-archiver
    â”‚   â””â”€â”€ pom.properties
    â”œâ”€â”€ maven-status
    â”‚   â””â”€â”€ ...
    â”œâ”€â”€ web-app
    â”‚   â”œâ”€â”€ ...
    â””â”€â”€ web-app.war
```

## Dockerfile
Dockerfileã¯ã‚·ãƒ³ãƒ—ãƒ«ã§tomcatã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æŒ‡å®šã—ã¦ã€ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚ã‚‹`war`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ³ãƒ†ãƒŠã«ã‚³ãƒ”ãƒ¼ã—ã¦ã‚ã’ã‚‹ã ã‘ã€‚

tomcatã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã¯ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ãŒä½¿ç”¨ã§ãã‚‹ã€‚
```
CATALINA_BASE:   /usr/local/tomcat
CATALINA_HOME:   /usr/local/tomcat
CATALINA_TMPDIR: /usr/local/tomcat/temp
JRE_HOME:        /usr
CLASSPATH:       /usr/local/tomcat/bin/bootstrap.jar:/usr/local/tomcat/bin/tomcat-juli.jar
```

```dockerfile
FROM tomcat: 10.0.14

COPY ../taget/web-app.war $CATALINA_HOME/webapps/
```

## docker-compsoe
`docker/Dockerfile`ã‚’ä½¿ç”¨ã—ã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã—ã€ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã™ã‚‹ã€‚ã„ã¡ã„ã¡ãƒ“ãƒ«ãƒ‰ã—ç›´ã™ã®ã¯é¢å€’ã ã£ãŸã®ã§ã€`volumes`ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã€‚

```yaml
version: '3'
services:
  tomcat:
    build:
      context: .
      dockerfile: docker/Dockerfile
    volumes:
      - ./target/web-app.war:/usr/local/tomcat/webapps/web-app.war
    ports:
      - "8080:8080"
```

## èµ·å‹•ãƒ†ã‚¹ãƒˆ
`docker-compose up -d`ã‚³ãƒãƒ³ãƒ‰ã§ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ã€`localhost:8080/web-app`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨`index.jsp`ã®å†…å®¹ãŒç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹ã€‚

ä»Šå›ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆã—ãŸã€‚
```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <form action="formservlet" method="post">
    <label for="name">Name:</label><br>
    <input type="text" id="name" name="name"><br><br>
    
    <label for="email">Email:</label><br>
    <input type="email" id="email" name="email"><br><br>
    
    <input type="submit" value="Submit">
</form>
</body>
</html>
```

è¡¨ç¤ºç”»é¢

![docker-tomcat](/images/docker-tomcat.png)

çµ‚äº†ã™ã‚‹éš›ã¯`docker-compose down`ã‚’å®Ÿè¡Œã€‚
dockerã§tomcatç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒã§ããŸğŸ‘